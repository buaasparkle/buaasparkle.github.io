---
layout: post
title:  "ARTS-æ‰“å¡-11"
date:   2020-08-10 00:05:41 +0800
categories: ARTS
tags: ARTS
---

# Algorithm

***[703. Kth Largest Element in a Stream]***

éšæœºæŒ‘é€‰ï¼Œéš¾åº¦ Easy

### é¢˜ç›®ä¿¡æ¯
> Design a class to find the kth largest element in a stream. Note that it is the kth largest element in the sorted order, not the kth distinct element.

> Your KthLargest class will have a constructor which accepts an integer k and an integer array nums, which contains initial elements from the stream. For each call to the method KthLargest.add, return the element representing the kth largest element in the stream.

> Example:

```java
int k = 3;
int[] arr = [4,5,8,2];
KthLargest kthLargest = new KthLargest(3, arr);
kthLargest.add(3);   // returns 4
kthLargest.add(5);   // returns 5
kthLargest.add(10);  // returns 5
kthLargest.add(9);   // returns 8
kthLargest.add(4);   // returns 8
```

> Note:
> You may assume that nums' length â‰¥ k-1 and k â‰¥ 1.

### åˆ†æ
å¼€å§‹é¢˜ç›®ç†è§£é”™äº†ï¼Œä»¥ä¸ºæ˜¯ç”±å°åˆ°å¤§æ’åˆ—çš„ç¬¬ K ä¸ªå…ƒç´ ï¼Œè€Œä¸”æ¯æ¬¡ add è¿”å›åå°±ä¼šä» stream ä¸­ç§»é™¤ï¼Œæ°å·§çš„æ˜¯ Example çš„å‰å‡ ä¸ª case éƒ½ä¸­ï¼Œåªæœ‰æœ€åä¸€ä¸ª add(4) è¿”å› 8 ä¸å¯¹ï¼Œè¿˜ä»¥ä¸ºæ˜¯é¢˜ç›®æµ‹è¯•ç”¨ä¾‹ç»™é”™äº†ğŸ¤¦â€â™‚ï¸

åæ¥æäº¤å¤±è´¥åçœ‹äº†ä¸€ä¸‹è®¨è®ºåŒºä¸­è§£æ³•ï¼Œå‘ç°æ˜¯è‡ªå·±ç†è§£é”™äº†ï¼Œä¿®æ”¹åé€šè¿‡ã€‚

é¢˜ç›®ç›´è§‚æ„Ÿè§‰æ˜¯ä¸€ä¸ª`å †`é—®é¢˜ï¼Œå³æœ‰ K ä¸ªå…ƒç´ çš„æœ€å°å †ï¼Œæ ¹éƒ¨å€¼å³ä¸º`ç¬¬ K å¤§å…ƒç´ `ã€‚

æœç´¢äº†ä¸€ä¸‹å †çš„å®ç°ï¼ˆæ—©å·²å¿˜è®°ï¼‰ï¼Œç»“æ„æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ•°ï¼Œä»¥æ•°ç»„çš„å½¢å¼ä¿å­˜ï¼Œé€šè¿‡ index è®¡ç®—å­©å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„ä½ç½®ï¼š

- ç¬¬ i ä¸ªèŠ‚ç‚¹çš„å·¦å­©å­ indexï¼š```i * 2 + 1```
- ç¬¬ i ä¸ªèŠ‚ç‚¹çš„å³å­©å­ indexï¼š```i * 2 + 2```
- ç¬¬ i ä¸ªèŠ‚ç‚¹çš„çˆ¶äº² indexï¼š```(i - 1) / 2```

æ¶‰åŠ 2 ç§æ›´æ–°æ–¹å¼ï¼š

- ä»äºŒå‰æ ‘åº•éƒ¨æ’å…¥ï¼Œæ’åœ¨æ•°ç»„çš„æœ€åé¢ï¼Œé€ä¸ªåŒçˆ¶äº²æ¯”è¾ƒç›´è‡³ä¸ç”¨äº¤æ¢
- ä»äºŒå‰æ ‘æ ¹éƒ¨æ›´æ–°ï¼Œæ›¿æ¢ä¸ºæ–°çš„å€¼åï¼Œå’Œå·¦å³å­©å­çš„æœ€å¤§ï¼ˆå°ï¼‰å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°ä¸ç”¨æ›¿æ¢

### æäº¤

```kotlin
class KthLargest(private val k: Int, private val nums: IntArray) {

    // ç»´æŠ¤ä¸€ä¸ªé•¿åº¦ä¸º K çš„æœ€å°å †, åªç»´æŠ¤æœ€å¤§çš„ K ä¸ªæ•°ï¼Œæ ¹å€¼ä¸ºç¬¬ K å¤§
    private val kthHeap = ArrayList<Int>(k)

    init {
        setupKthHeap()
    }

    private fun setupKthHeap() {
        nums.forEach { insertToHeap(it) }
    }

    // è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦å…¥å †
    private fun insertToHeap(value: Int) {
        return when {
            kthHeap.size < k -> { // å †æœªæ»¡ï¼Œç›´æ¥æ’å…¥
                kthHeap.add(value)
                shiftUp()
            }
            value > kthHeap.first() -> { // å¤§äºå †çš„æœ€å°å€¼ï¼Œæ›¿æ¢æ‰æœ€å°å€¼ä»ä¸Šå‘ä¸‹è°ƒæ•´å †
                kthHeap[0] = value
                shiftDown()
            }
            else -> { // å †å·²æ»¡ä¸”æ¯”æœ€å¤§å€¼è¿˜å¤§ï¼Œå¿½ç•¥å¤„ç†
            }
        }
    }

    // æ›´æ–°æœ€åä¸€ä¸ªå…ƒç´ åœ¨å †ä¸­çš„ä½ç½®
    private fun shiftUp() {
        var curIndex = kthHeap.size - 1
        var parentIndex = (curIndex - 1) / 2
        while (parentIndex >= 0 && kthHeap[curIndex] < kthHeap[parentIndex]) {
            swap(curIndex, parentIndex)
            curIndex = parentIndex
            parentIndex = (curIndex - 1) / 2
        }
    }

    // æ›´æ–°ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨å †ä¸­çš„ä½ç½®
    private fun shiftDown() {
        var curIndex = 0
        var maxChild = findMinChild(curIndex)
        while (maxChild != null && kthHeap[curIndex] > maxChild.first) {
            swap(curIndex, maxChild.second)
            curIndex = maxChild.second
            maxChild = findMinChild(curIndex)
        }
    }

    private fun swap(i: Int, j: Int) {
        val temp = kthHeap[i]
        kthHeap[i] = kthHeap[j]
        kthHeap[j] = temp
    }

    private fun findMinChild(index: Int): Pair<Int, Int>? { // <MinValue, index>
        val leftChildIndex = index * 2 + 1
        val rightChildIndex = index * 2 + 2
        return when {
            leftChildIndex >= kthHeap.size -> null
            rightChildIndex >= kthHeap.size -> Pair(kthHeap[leftChildIndex], leftChildIndex)
            else -> {
                val isLeft = kthHeap[leftChildIndex] < kthHeap[rightChildIndex]
                val minValueIndex = if (isLeft) leftChildIndex else rightChildIndex
                Pair(kthHeap[minValueIndex], minValueIndex)
            }
        }
    }

    fun add(value: Int): Int {
        insertToHeap(value)
        return kthHeap[0]
    }
}
```

æ‰§è¡Œç»“æœï¼š

> Runtime: 532 ms, faster than 54.55% of Kotlin online submissions for Kth Largest Element in a Stream.
> Memory Usage: 63.4 MB, less than 9.09% of Kotlin online submissions for Kth Largest Element in a Stream.

# Review

***[New APIs in the Android Gradle Plugin]***

æ–° API åº”è¯¥æ˜¯æŒ‡ AGP 4.1ï¼Œæ”¯æŒäº† kotlin DSLï¼Œå¹¶æä¾›äº†æ–°çš„[æ–‡æ¡£](https://developer.android.com/reference/tools/gradle-api/classes)è¯´æ˜.

å…¶ä»–çš„å…¶å®å°±æ²¡å¤ªçœ‹æ‡‚äº†ï¼Œè¿˜æ˜¯å¯¹ Android Gradle æ’ä»¶è¿™å—äº†è§£æ¯”è¾ƒè–„å¼±ï¼Œè®°ä¸€ä¸ªæ–‡ä¸­æåˆ°çš„æ„å»ºé˜¶æ®µå§ï¼š

> 1) Build scripts are run, allowing the build and plugins to configure the Android Gradle Plugin DSL objects as well as registering variant callbacks.

> 2) The Android Gradle Plugin combines build types and product flavors to create variants and test components.

> 3) The onVariants API is invoked for each variant, allowing the customization of variant settings, and the onTestComponent API is invoked for each test component.

> 4) The onVariantProperties API is invoked for each variant that was enabled and the onTestComponentProperties API is invoked for each enabled test component allowing the registration of tasks that consume or modify intermediates of the build.

> 5) The Android Gradle Plugin registers tasks for the variants after both the onVariants and the onVariantProperties callbacks have been called.

> 6) The previous variant API is called for each variant, using the registered tasks.

> 7) Gradle calculates the task graph, and the build can begin executing.

# Tips

***man***
linux command line -> manual

æœ‰å¤šç§é¡µç±»å‹ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ `man man` æŸ¥çœ‹

```
The table below shows the section numbers of the manual followed by the types of pages they contain.

1   Executable programs or shell commands
2   System calls (functions provided by the kernel)
3   Library calls (functions within program libraries)
4   Special files (usually found in /dev)
5   File formats and conventions eg /etc/passwd
6   Games
7   Miscellaneous (including macro packages and conventions), e.g. man(7), groff(7)
8   System administration commands (usually only for root)
9   Kernel routines [Non standard]
```

æ¯”å¦‚ `man 3 printf` å°±å¯ä»¥æŸ¥çœ‹ printf åœ¨ C åº“ä¸­çš„ä½¿ç”¨è¯´æ˜ã€‚

# Share
æ— 

<!-- refs -->
[703. Kth Largest Element in a Stream]:https://leetcode.com/problems/kth-largest-element-in-a-stream/

[New APIs in the Android Gradle Plugin]: https://medium.com/androiddevelopers/new-apis-in-the-android-gradle-plugin-f5325742e614