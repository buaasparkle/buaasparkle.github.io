---
layout: post
title:  "The Art of Readable Code"
date:   2020-07-25 9:35:22 +0800
categories: coding
tags: coding
---

# 前言

这周抽空读了《编写可读代码的艺术》这本书，选择之初是有大牛同事推荐，正好看到 Kindle 上有就下载下来读了，更主要的是显示只有 178 页，小部头读起来更有信心些 😂。

书中内容的组织主要分为 4 部分：

1. 表面层次的改进
2. 简化循环和逻辑
3. 重新组织你的代码
4. 精选话题

可以说是由表及里给出改善代码可读性的锦囊妙计，通读完个人感觉这本书适合：

- 代码新手

如果是刚参加工作的新同学，恰巧你之前也同我类似代码量着实不多，强力推荐

- 希望代码更容易被人/被己理解

主动去站在别人的角度考虑自己撸的代码是不是容易被理解可能并不容易，但至少为 6 个月后的自己留条后路吧

- Reviewer

如果 reviewer 的时候发现团队中的同学或多或少出现书中列出的问题，那么赶紧安利给团队吧

本文余下内容全部为“引玉”，书中每个章节最后都给出了精炼归纳的总结，下面做的就是把这些精华摘录分享出来。

# 精华总结

### 第1章 代码应当易于理解

可读性原理：

> 代码的写法应当使别人理解它所需的时间最小化

## 第一部分 表面层次的改进

### 第2章 把信息装到名字里

> 读者仅通过名字就可以获得大量信息

- 使用专业的单词 —— 例如，不用 `Get`，而用 `Fetch` 或者 `Download` 可能会更好，这由上下文决定。

- 避免空泛的名字，像 tmp 和 retval，除非使用它们有特殊的理由。

- 使用具体的名字来更细致地描述事物 —— `ServerCanStart()` 这个名字就比 `CanListenOnPort` 更不清楚。

- 给变量名带上重要的细节 —— 例如，在值为毫秒的变量后面加上`_ms`，或者在还需要转义的，未处理的变量前面加上`raw_`。

- 为作用域大的名字采用更长的名字 —— 不要用让人费解的一个或两个字母的名字来命名在几屏之间都可见的变量。对于只存在于几行之间的变量用短一点的名字更好。

- 有目的地使用大小写、下划线等 —— 例如，你可以在类成员和局部变量后面加上 `“_”` 来区分它们。

### 第3章 不用会误解的名字

> 阅读你代码的人应该理解你的本意，并且不会有其他的理解

- 当要定义一个值的上限或下限时，`max_`和`min_`是很好的前缀。对于包含的范围，`first`和`last`是好的选择。对于包含/排除范围，`begin`和`end`是最好的选择，因为它们都最常用。

- 当为布尔值命名时，使用 `is` 和 `has` 这样的词来明确表示它是个布尔值，避免使用反义的词（例如 disable_ssl）。

- 要小心用户对特定词的期望。例如，用户会渴望`get()`或者`size()`是轻量的方法。

### 第4章 审美

> 通常把代码用一致的、有意义的方式“格式化”，可以把代码变得更容易读，并且可以读的更快。

- 如果有多个代码块做相似的事情，尝试让它们有相同的剪影。
【剪影指代码结构类似】

- 把代码按“列”对齐可以让代码更容易浏览。

- 如果在一段代码中提到 A、B 和 C，那么不要在另一段代码中说 B、C 和 A。选择一个有意义的顺序并始终用这个顺序。

- 用空行把大块代码分成逻辑上的“段落”。

### 第5章 该写什么样的注释

> 注释的目的是尽量帮助读者了解的和作者一样多。

什么地方不需要注释：

- 能从代码本身迅速地推断的事务

- 用来粉饰烂代码（例如蹩脚的函数名）的“拐杖式注释” —— 应该把代码写好。

你应该记录下来的想法包括：

- 对于为什么代码写成这样而不是那样的内在理由（“指导性批注”）

- 代码中的缺陷，使用像 TODO，或者 XXX 这样的标记。

| 标记 | 通常的意义 |
| ---  |  ------- |    
| TODO | 我还没有处理的事情 |
| FIXME | 已知的无法运行的代码 |
| HACK | 对一个问题不得不采用的比较粗糙的解决方案 |
| XXX | 危险！这里有重要的问题 |

- 常量背后的故事，为什么是这个值

站在读者的立场思考：

- 预料到代码中哪些部分会让读者说：“啊？”并给它们加上注释。

- 为普通读者意料之外的行为加上注释

- 在文件/类的级别上使用“全局观”注释来解释所有的部分是如何一起工作的。

- 用注释总结代码块，让读者不致迷失在细节中

### 第6章 写出言简意赅的注释

> 注释应当有很高的信息/空间率

- 当像“it”和“this”这样的代词可能指代多个事物时，避免使用它们。

- 尽量精确的描述函数的行为

- 在注释中用精心挑选的输入/输出例子进行说明。
【+1】

- 声明代码的高层次意图，而非明显的细节

- 用嵌套的注释（如 Function(/*arg=*/...)）来解释难以理解的函数参数。
【命名参数】

- 用含义丰富的词来使注释简洁
【比如一个通用的术语就好过自己的一通解释】

## 第二部分 简化循环和逻辑

### 第7章 把控制流变得易读

- 在写一个比较时，把改变的值写在左边并且把更稳定的值写在右边更好一些

```java
while (bytes_expected > bytes_received) // 👎
```

```java
while (bytes_received < bytes_expected) // 👍
```

- 可以重新排列 if/else 中的语句块。通常来讲，优先处理正确的/简单的/有趣的情况。有时这些准则会冲突，但是当不冲突时，这是要遵循的经验法则。

- 某些编程结构，像三目运算符（?:）、do/while 循环，以及 goto 经常会导致代码的可读性变差。最好不要使用它们，因为总是有更简洁的代替方式。

- 嵌套的代码块需要更加集中精力去理解。每层新的嵌套都需要读者把更多的上下文“压入栈”。应该把它们改写成更加“线性”的代码来避免深嵌套。

- 通常来讲提早返回可以减少嵌套并让代码整洁。“保护语句”（在函数顶部处理简单的情况时）尤其有用。

### 第8章 拆分超长的表达式

> 把你的超长表达式拆分成更容易理解的小块

一个简单的技术是引入“解释变量”来代表较长的子表达式。这种方式有 3 个好处：

1. 它把巨大的表达式拆成小段

2. 它通过简单的名字来描述子表达式来让代码文档化

3. 它帮助读者识别代码中的主要概念

另一个技术是用 `德摩根定理` 来操作逻辑表达式 —— 这个技术有时可以把布尔表达式用更简洁的方式重写。例如：
```java
if (!(a && !b)) 👉 if (!a || b)
```

- 有时需要把问题“反向”或者考虑目标的对立面

- 这些技术同样也常应用于大的代码块

### 第9章 变量与可读性

> 1. 变量越多，就越难全部跟踪它们的动向
> 2. 变量的作用域越大，就需要跟踪它的动向越久
> 3. 变量改变得越频繁，就越难以跟踪他的当前值

- 减少变量，即那些妨碍的变量。（比如立刻处理结果来消除“中间结果”变量）

- 减小每个变量的作用域，越小越好。把变量移到一个有最少代码可以看到它的地方。眼不见，心不烦。

- 只写一次的变量更好。那些只设置一次的变量（或者 const、final、常量）使代码更容易理解。

## 第三部分 重新组织代码

### 第10章 抽取不相关的子问题

> 把一般代码和项目专有代码分开。通过建立一大组库和辅助函数来解决一般问题，剩下的只是让你的程序与众不同的核心部分

这个技巧有帮助的原因是它使程序员更关注小而良好的问题，这些问题已经同项目的其他部分脱离。

其结果是，对于这些子问题的解决方案倾向于更加完整和正确。你也可以在以后重用它们。

### 第11章 一次只做一件事

> 应该把代码组织得一次只做一件事情

如果你有很难读得代码，尝试把它所做得所有任务列出来。其中一些任务可以很容易得变成单独得函数（类）。

其他的可以简单地成为一个函数中的逻辑“段落”。

具体如何拆分这些任务没有它们已经分开这个事情那样重要。难的是要准确地描述你的程序所做的所有这些小事情。

### 第12章 把想法变成代码

> 用自然语言描述程序然后用这个描述来帮助你写出更自然的代码。

另一个看待这个问题的角度是：如果你不能把问题说明白或者用词语来做设计，估计是缺少来什么东西或者什么东西缺少定义。

把一个问题（或想法）变成语言真的可以让它更具体。

### 第13章 少写代码

> 代码写越少越好。每一行新的代码都需要测试、写文档和维护。另外，代码库中的代码越多，它就越“重”，而且在其上开发就越难。

- 从项目中消除不必要的功能，不要过度设计

- 重新考虑需求，解决版本最简单的问题，只要能完成工作就行。

- 经常性地通读标准库的整个 API，保持对它们的熟悉程度。
【+1】

## 第四部分 精选话题

### 第14章 测试与可读性

> 测试代码应该具有可读性，以便其他程序员可以舒服地改变或者增加测试。

- 每个测试的最高一层应该越简明越好。最好每个测试输入/输出可以用一行代码来描述。

- 如果测试失败了，它所发出的错误消息应该能让你容易跟踪并修正这个 bug。

- 使用最简单的并且能够完整运用代码的测试输入

- 给测试函数取一个有完整描述性的名字，以便每个测试所测到的东西很明确。

- 最重要的是，它要易于改动和增加新的测试。

# 结语

摘录完书中给出很多“道”与“术”后，对我个人而言影响最大的还是开篇的那句：

> 代码的写法应当使别人理解它所需的时间最小化

之所以发明高级语言，就是想让它更容易被`人`理解，尤其在当下这种以团队合作为主的开发流程中，容易被理解的代码通常还具备`易 review`，`易测试`，`易维护`，`易扩展`等特点。

希望能向着 `我出品，必精品` 的道路上前进。

# 参考资料

[《编写可读代码的艺术》](https://www.amazon.cn/dp/B00E593N1U/ref=sr_1_1?__mk_zh_CN=%E4%BA%9A%E9%A9%AC%E9%80%8A%E7%BD%91%E7%AB%99&crid=16U8OCX68T0EY&keywords=the+art+of+readable+code&qid=1595641659&s=digital-text&sprefix=the+art+of+rea%2Cdigital-text%2C146&sr=1-1)